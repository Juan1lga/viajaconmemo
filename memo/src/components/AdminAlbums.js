import React, { useEffect, useState } from "react";import { getPendingAlbums, approveAlbum, assetsOrigin, isTimeoutLike } from "../utils/api";import "./AdminDashboard.css";const AdminAlbums = ({ token }) => { const [albums, setAlbums] = useState([]); const [loading, setLoading] = useState(true); const [error, setError] = useState(""); const [message, setMessage] = useState(""); const fetchPending = async () => { setLoading(true); try { const { data } = await getPendingAlbums(); setAlbums(Array.isArray(data) ? data : []); setError(""); } catch (err) { if (isTimeoutLike(err)) { return; } const msg = err?.response?.data?.msg || "No se pudieron cargar los álbumes pendientes"; setError(msg); } finally { setLoading(false); } }; useEffect(() => { fetchPending(); }, []); const handleApprove = async (id) => { try { await approveAlbum(id); setMessage("Álbum aprobado correctamente."); setError(""); setAlbums((prev) => prev.filter((a) => a._id !== id)); } catch (err) { if (isTimeoutLike(err)) { return; } const msg = err?.response?.data?.msg || "Error al aprobar el álbum"; setError(msg); } }; const coverSrc = (a) => { const url = a?.coverUrl || ""; if (!url) return ""; return url.startsWith("http") ? url : `${assetsOrigin}${url}`; }; return (<div className="admin-dashboard"> <div className="admin-dashboard-header" style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}> <h2 className="m-0">Gestionar Álbumes</h2> <div> <button className="btn" onClick={fetchPending} disabled={loading}>{loading ? "Actualizando..." : "Refrescar"}</button> </div> </div> {error && <div className="notice error" style={{ marginBottom: "12px" }}>{error}</div>} {message && <div className="notice success" style={{ marginBottom: "12px" }}>{message}</div>} {loading ? (<p>Cargando álbumes pendientes...</p>) : (albums.length === 0 ? (<p>No hay álbumes pendientes de aprobación.</p>) : (<table> <thead> <tr> <th>Portada</th> <th>Nombre</th> <th>Slug</th> <th>Creado</th> <th>Acciones</th> </tr> </thead> <tbody> {albums.map((a) => ( <tr key={a._id}> <td>{a.coverUrl ? (<img src={coverSrc(a)} alt={a.name || "Álbum"} style={{ width: "64px", height: "64px", objectFit: "cover", borderRadius: "6px" }} />) : (<span className="text-muted">Sin portada</span>)}</td> <td>{a.name || "(Sin nombre)"}</td> <td>{a.slug || "-"}</td> <td>{a.createdAt ? new Date(a.createdAt).toLocaleString() : "-"}</td> <td> <button className="btn btn-outline-primary btn-sm" onClick={() => handleApprove(a._id)}>Aprobar</button> </td> </tr> ))} </tbody> </table> ))} </div> );};export default AdminAlbums;